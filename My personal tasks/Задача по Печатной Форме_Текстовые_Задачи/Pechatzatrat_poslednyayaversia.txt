////////////////////////////////////////////////////////////////////////////////
УДАЛИТЬ ПРОЦЕДУРУ - ВСТАВИТЬ ЭТУ ФУНКЦИЮ

Функция ПечатьРаспределниеНаПродукцию(МассивОбъектов, ОбъектыПечати) Экспорт
    
    ТабДок = Новый ТабличныйДокумент;
	ТабДок.ИмяПараметровПечати = "ПечатьЗатрат";
    ТабДок.АвтоМасштаб = Истина;
    
    // получим макет и области
    Макет = Документы.РаспределениеПрочихЗатрат.ПолучитьМакет("ПечатьРаспределниеНаПродукцию");
    ОбластьЗаголовок                = Макет.ПолучитьОбласть("Заголовок");
    Шапка                           = Макет.ПолучитьОбласть("Шапка");
    Область                         = Макет.ПолучитьОбласть("СуммыКРаспределениюШапка");
    ОбластьСуммыКРаспределению      = Макет.ПолучитьОбласть("СуммыКРаспределению");
    ОбластьИтогиСуммыКРаспределению = Макет.ПолучитьОбласть("СуммыКРаспределениюИтоги");
    ОбластьЗатратыНаПродукциюШапка  = Макет.ПолучитьОбласть("ЗатратыНаПродукциюШапка");
    ОбластьЗатратыНаПродукцию       = Макет.ПолучитьОбласть("ЗатратыНаПродукцию");
    ОбластьИтогиСуммыЗатраты        = Макет.ПолучитьОбласть("ЗатратыКРаспределениюИтоги");
    
    // получим выборку
    Выборка = ПолучитьВыборку(МассивОбъектов);
    
    // выведем выборку в табличный документ
    ТабДок.Очистить();
    ВставлятьРазделительСтраниц = Ложь;
    Пока Выборка.Следующий() Цикл
        
        Если ВставлятьРазделительСтраниц Тогда
            ТабДок.ВывестиГоризонтальныйРазделительСтраниц();
        КонецЕсли;
        
        ТабДок.Вывести(ОбластьЗаголовок);
        
        Шапка.Параметры.Заполнить(Выборка);
        ТабДок.Вывести(Шапка, Выборка.Уровень());
        
        // ПЕРВАЯ ТЧ ///////////////////////
        ТабДок.Вывести(Область);
        ВыборкаСуммыКРаспределению = Выборка.СуммыКРаспределению.Выбрать();
        Пока ВыборкаСуммыКРаспределению.Следующий() Цикл
            ОбластьСуммыКРаспределению.Параметры.Заполнить(ВыборкаСуммыКРаспределению);
            ТабДок.Вывести(ОбластьСуммыКРаспределению);
        КонецЦикла;
        // итоги первой тч
        ОбластьИтогиСуммыКРаспределению.Параметры.СуммаИтогоСуммы = Выборка.ИтогоСуммаКРаспределению;
        ТабДок.Вывести(ОбластьИтогиСуммыКРаспределению);
               
        // ВТОРАЯ ТЧ ///////////////////////
        ТабДок.Вывести(ОбластьЗатратыНаПродукциюШапка);
        ВыборкаЗатратыНаПродукцию = Выборка.ЗатратыНаПродукцию.Выбрать();
        Пока ВыборкаЗатратыНаПродукцию.Следующий() Цикл
            ОбластьЗатратыНаПродукцию.Параметры.Заполнить(ВыборкаЗатратыНаПродукцию);
            ТабДок.Вывести(ОбластьЗатратыНаПродукцию, ВыборкаЗатратыНаПродукцию.Уровень());
        КонецЦикла;
        // итоги второй тч
        ОбластьИтогиСуммыЗатраты.Параметры.СуммаИтогоЗатраты = Выборка.ИтогоСуммаЗатратНаПродукцию;;
        ТабДок.Вывести(ОбластьИтогиСуммыЗатраты);
        
        ВставлятьРазделительСтраниц = Истина;		
    КонецЦикла;

	Возврат ТабДок;
	
КонецФункции

////////////////////////////////////////////////////////////////////////////////
ВСТАВИТЬ В КОНЦЕ В МОДУЛЬ МЕНЕДЖЕРА   (тут же где и печать формируется)

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ ПЕЧАТИ

// Сформировать печатные формы объектов
//
// ВХОДЯЩИЕ:
//   ИменаМакетов    - Строка    - Имена макетов, перечисленные через запятую
//   МассивОбъектов  - Массив    - Массив ссылок на объекты которые нужно распечатать
//   ПараметрыПечати - Структура - Структура дополнительных параметров печати
//
// ИСХОДЯЩИЕ:
//   КоллекцияПечатныхФорм - Таблица значений - Сформированные табличные документы
//   ПараметрыВывода       - Структура        - Параметры сформированных табличных документов
//
Процедура Печать(МассивОбъектов, ПараметрыПечати, КоллекцияПечатныхФорм, ОбъектыПечати, ПараметрыВывода) Экспорт
	
	Если УправлениеПечатью.НужноПечататьМакет(КоллекцияПечатныхФорм, "ПечатьЗатрат") Тогда
		                                                                         
		УправлениеПечатью.ВывестиТабличныйДокументВКоллекцию(КоллекцияПечатныхФорм, 
                                                            "ПечатьЗатрат", 
                                                            "Распределение прочих затрат", 
                                                            ПечатьРаспределниеНаПродукцию(МассивОбъектов, ОбъектыПечати));
		
	КонецЕсли;
	
КонецПроцедуры // Печать()


////////////////////////////////////////////////////////////////////////////////
В КОМАНДЕ ВСЕ УДАЛИТЬ И ВСТАВИТЬ ЭТО:

&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
    
    
    УправлениеПечатьюКлиент.ВыполнитьКомандуПечати(
			"Документ.РаспределениеПрочихЗатрат",
			"ПечатьЗатрат",
			ПараметрКоманды,
			Неопределено,
			Неопределено
		);
        
КонецПроцедуры
